<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Zeitform-Zwerg ‚Äì Multilevel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #000; }
        canvas { display: block; margin: 0 auto; }
        #controls {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; z-index: 10;
        }
        .btn {
            width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.3);
            display: flex; align-items: center; justify-content: center; font-size: 28px; color: #fff;
            user-select: none; touch-action: manipulation;
        }
        #hilfe {
            position: absolute; top: 10px; right: 10px; background: white; color: black; padding: 10px;
            border-radius: 8px; max-width: 300px; display: none; z-index: 10;
        }
    </style>
</head>
<body>
<div id="hilfe">
    <strong>üéÆ Steuerung:</strong><br>
    ‚û°Ô∏è Pfeiltasten ODER Touch-Buttons<br>
    ‚¨ÜÔ∏è Springe zu Antwort oder gehe zur T√ºr<br>
    üë£ Ber√ºhre die richtige Antwort<br><br>
    <button onclick="document.getElementById('hilfe').style.display='none'">Schlie√üen</button>
</div>
<div id="controls">
    <div class="btn" id="left">‚Üê</div>
    <div class="btn" id="jump">‚Üë</div>
    <div class="btn" id="right">‚Üí</div>
</div>
<script>
const tasks = [
    {type: 'door', frage: 'Ich ___ (gehen) zur Schule.', richtig: 'gehe', falsch: ['ging','gegangen']},
    {type: 'jump', frage: 'Du ___ (fahren) mit dem Bus.', richtig: 'f√§hrst', falsch: ['fuhr','gefahren']},
    {type: 'maze', frage: 'Er ___ (lesen) ein Buch.', richtig: 'liest', falsch: ['las','gelesen']}
];

let currentTask = 0;

const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#ddeeff',
    physics: {
        default: 'arcade',
        arcade: { gravity: { y: 400 }, debug: false }
    },
    scene: { preload, create, update }
};

let player, cursors, jumpBtn, leftBtn, rightBtn, frageText, controls, activeScene, boden;

const game = new Phaser.Game(config);

function preload() {
    this.load.image('boden', 'https://labs.phaser.io/assets/sprites/platform.png');
    this.load.image('spieler', 'https://labs.phaser.io/assets/sprites/phaser-dude.png');
    this.load.image('tuer', 'https://labs.phaser.io/assets/sprites/door_closed_top.png');
}

function create() {
    activeScene = this;
    cursors = this.input.keyboard.createCursorKeys();

    boden = this.physics.add.staticGroup();
    boden.create(400, 580, 'boden').setScale(2).refreshBody();

    player = this.physics.add.sprite(100, 450, 'spieler');
    player.setScale(2);
    player.setBounce(0.1);
    player.setCollideWorldBounds(true);

    this.physics.add.collider(player, boden);

    frageText = this.add.text(20, 20, '', { fontSize: '22px', fill: '#000' });

    setupTouchControls();
    document.getElementById('hilfe').style.display = 'block';

    showTask(tasks[currentTask]);
}

function update() {
    if (leftBtn || cursors.left.isDown) {
        player.setVelocityX(-160);
    } else if (rightBtn || cursors.right.isDown) {
        player.setVelocityX(160);
    } else {
        player.setVelocityX(0);
    }

    if ((jumpBtn || cursors.up.isDown) && player.body.touching.down) {
        player.setVelocityY(-330);
        jumpBtn = false;
    }
}

function showTask(task) {
    frageText.setText(task.frage);

    if (task.type === 'door') showDoorTask(task);
    else if (task.type === 'jump') showJumpTask(task);
    else if (task.type === 'maze') showMazeTask(task);
}

function showDoorTask(task) {
    const szene = activeScene;
    const doors = [task.richtig, ...task.falsch].sort(() => 0.5 - Math.random());
    doors.forEach((txt, i) => {
        const door = szene.physics.add.sprite(200 + i * 180, 500, 'tuer').setScale(0.5);
        door.setImmovable(true);
        door.antwort = txt;
        szene.physics.add.overlap(player, door, () => {
            if (door.antwort === task.richtig) {
                frageText.setText('‚úÖ Richtig!');
                nextTask(szene);
            } else {
                frageText.setText('‚ùå Falsch!');
            }
        });
    });
}

function showJumpTask(task) {
    const szene = activeScene;
    const answers = [task.richtig, ...task.falsch].sort(() => 0.5 - Math.random());
    answers.forEach((antwort, index) => {
        const x = 150 + index * 220;
        const text = szene.add.text(x, 200, antwort, { fontSize: '20px', fill: '#fff', backgroundColor: '#0099cc', padding: 10 });
        szene.physics.world.enable(text);
        text.body.setImmovable(true);
        text.body.setAllowGravity(false);
        text.antwort = antwort;
        szene.physics.add.overlap(player, text, () => {
            if (antwort === task.richtig) {
                frageText.setText('‚úÖ Richtig!');
                nextTask(szene);
            } else {
                frageText.setText('‚ùå Falsch!');
            }
        });
    });
}

function showMazeTask(task) {
    const szene = activeScene;
    const ziel = szene.add.text(700, 500, task.richtig, { fontSize: '24px', fill: '#fff', backgroundColor: '#0099cc', padding: 10 });
    szene.physics.world.enable(ziel);
    ziel.body.setImmovable(true);
    ziel.body.setAllowGravity(false);
    szene.physics.add.overlap(player, ziel, () => {
        frageText.setText('‚úÖ Richtig!');
        nextTask(szene);
    });
    const wand = szene.add.rectangle(400, 400, 300, 20, 0x666666);
    szene.physics.add.existing(wand, true);
    szene.physics.add.collider(player, wand);
}

function nextTask(scene) {
    scene.time.delayedCall(1500, () => {
        currentTask = (currentTask + 1) % tasks.length;
        scene.scene.restart();
    });
}

function setupTouchControls() {
    document.getElementById('left').ontouchstart = () => leftBtn = true;
    document.getElementById('right').ontouchstart = () => rightBtn = true;
    document.getElementById('jump').ontouchstart = () => jumpBtn = true;
    document.getElementById('left').ontouchend = () => leftBtn = false;
    document.getElementById('right').ontouchend = () => rightBtn = false;
}
</script>
</body>
</html>
